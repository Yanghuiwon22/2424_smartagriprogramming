<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>농업 작물 모니터링</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!--온도 아이콘-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--습도 아이콘-->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <--! 수위 아이콘-->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
<!-- Navigation Bar -->
<nav class="top-nav">
    <ul>
        <li><a href="#temp-section">온도</a></li>
        <li><a href="#humidity-section">습도</a></li>
        <li><a href="#water-level-section">물의 양</a></li>
        <li><a href="#irrigation-section">수위</a></li>
        <li><a href="#image-section">이미지</a></li>
    </ul>
</nav>

<!-- Main Section -->
<main>
    <!-- Cards for Navigation -->
    <section class="cards">

        <div class="card" onclick="scrollToSection('temp-section')">
            <h3>온도</h3>
            <div class="icon-container">
                <p><span class="material-icons" style="font-size: 4.0rem; color: #6a11cb;
                    vertical-align: middle;">device_thermostat</span>
                    <span id="sensor-temp">-</span>°C</p>
            </div>
        </div>

        <div class="card" onclick="scrollToSection('humidity-section')">
            <h3>습도 </h3>
            <div class="icon-container">
                <p><span class="material-symbols-outlined" style="font-size: 4.0rem; color: #5332db;
                    vertical-align: middle;">humidity_percentage</span>
                    <span id="sensor-humidity">-</span> %</p>
            </div>
        </div>

        <div class="card" onclick="scrollToSection('water-level-section')">
            <h3>수위 모니터링</h3>
            <div class="icon-container">
                <p><span class="material-symbols-outlined" style="font-size: 4.0rem; color: #3c53ec;
                        vertical-align: middle;">water_medium</span>
                    <span id="sensor-water">-</span></p>
            </div>
        </div>
        <div class="card" onclick="scrollToSection('irrigation-section')">
            <h3>관수 모니터링</h3>
            <div class="icon-container">
                <p><span class="material-symbols-outlined" style="font-size: 4.0rem; color: #3c53ec;
                        vertical-align: middle;">water_medium</span>
                    <span id="sensor-irrigation">-</span></p>
            </div>
        </div>
    </section>

    <!-- Sections -->
    {#    임의 온도 그래프 그려보기#}
    {#    <section id="temp-section" class="content-section">#}
    {#        <h2>온도 그래프</h2>#}
    {#        <canvas id="temp-chart" width="400" height="200"></canvas> <!-- 크기 조정 -->#}
    {#    </section>#}
    {#   여기까지 임의 온도 그래프 #}

    <section id="temp-section" class="content-section">
        <h2>온도 그래프</h2>
        <p>온도: <span id="sensor-temp">-</span> °C</p>

    </section>

    <section id="humidity-section" class="content-section">
        <h2>습도 모니터링</h2>
        <p>습도: <span id="sensor-humidity">-</span> %</p>
    </section>

    <section id="image-section" class="content-section">
        <h2>이미지 모니터링</h2>
        <img id="sensor-image" src="" alt="작물 이미지" style="max-width: 100%; border-radius: 10px;">
    </section>

    <section id="water-level-section" class="content-section">
        <h2>물의 양 모니터링</h2>
        <p>현재 물의 양: <span id="sensor-data">-</span> %</p>
    </section>


    <section id="water-pump-section" class="content-section">
    <h2>물 펌프 제어</h2>
    <button onclick="sendStateToFlask('on')">Turn ON</button>
    <button onclick="sendStateToFlask('off')">Turn OFF</button>
</section>
</main>

<!-- Footer -->
<footer>
    <small>&copy; 2024 농업 작물 모니터링 시스템</small>
</footer>
{##}
{#<!-- JavaScript --><!-- JavaScript -->#}
{#    임의 온도 그래프 그려보기#}
{#<script>#}
{#    document.addEventListener('DOMContentLoaded', function () {#}
{#    function fetchDataAndRenderChart(url, canvasId) {#}
{#        fetch(url)#}
{#            .then(response => response.json()) // JSON 응답 파싱#}
{#            .then(data => {#}
{#                const ctx = document.getElementById(canvasId).getContext('2d');#}
{#                new Chart(ctx, {#}
{#                    type: 'line',#}
{#                    data: {#}
{#                        labels: data.labels,#}
{#                        datasets: [{#}
{#                            label: 'Temperature (°C)',#}
{#                            data: data.data,#}
{#                            borderColor: 'rgba(75, 192, 192, 1)',#}
{#                            backgroundColor: 'rgba(75, 192, 192, 0.2)',#}
{#                        }]#}
{#                    },#}
{#                    options: {#}
{#                        responsive: true,#}
{#                        maintainAspectRatio: false,#}
{#                        scales: {#}
{#                            x: {#}
{#                                beginAtZero: true,#}
{#                                ticks: {#}
{#                                    maxTicksLimit: 10#}
{#                                }#}
{#                            },#}
{#                            y: {#}
{#                                beginAtZero: true,#}
{#                                ticks: {#}
{#                                    maxTicksLimit: 10,#}
{#                                    callback: function(value) {#}
{#                                        return value.toFixed(1);#}
{#                                    }#}
{#                                }#}
{#                            }#}
{#                        }#}
{#                    }#}
{#                });#}
{#            })#}
{#            .catch(error => {#}
{#                console.error('에러 발생:', error);#}
{#                document.getElementById(canvasId).innerHTML = '<div>데이터를 가져오는 데 실패했습니다.</div>';#}
{#            });#}
{#    }#}
{##}
{#    // 초기 차트 생성#}
{#    fetchDataAndRenderChart('/temp-data', 'temp-chart');#}
{##}
{#    // 3초마다 데이터 업데이트#}
{#    setInterval(() => fetchDataAndRenderChart('/temp-data', 'temp-chart'), 3000); // 3000ms = 3초#}
{# });#}
{#</script>#}
{#    여기까지 임의 온도 그래프 그리기#}
<script>
    function updateSensorData() {
        fetch('/temp-hum-data') // Flask 서버에서 데이터 가져오기
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json(); // JSON 응답 파싱
            })
            .then(data => {
                // 데이터가 정상적으로 수신된 경우
                console.log("Received data:", data);

                // 각 센서 데이터를 업데이트
                document.getElementById('sensor-temp').textContent = `${data.temp}`;
                document.getElementById('sensor-humidity').textContent = `${data.hum}`;
                document.getElementById('sensor-water').textContent = `${data.distance} cm`;
                document.getElementById('sensor-irrigation').textContent = `${data.weight} g`;

            })

            .catch(error => {
                // 오류가 발생한 경우
                console.error('Error fetching data:', error);


                // 오류 메시지를 각 요소에 표시
                document.getElementById('sensor-temp').textContent = '온도 데이터를 가져오는 데 실패했습니다.';
                document.getElementById('sensor-humidity').textContent = '습도 데이터를 가져오는 데 실패했습니다.';
                document.getElementById('sensor-water').textContent = '거리 데이터를 가져오는 데 실패했습니다.';
                document.getElementById('sensor-irrigation').textContent = '무게 데이터를 가져오는 데 실패했습니다.';

            });
    }

    document.addEventListener('DOMContentLoaded', function () {
        // 페이지 로드 시 초기 데이터 업데이트
        updateSensorData();

        // 5초마다 데이터 업데이트
        setInterval(updateSensorData, 5000);
    });
    function toggleWaterPump() {
        fetch('/toggle-water-pump', {
            method: 'POST'
        })
            .then(response => {
                if (response.ok) {
                    console.log("Water pump toggled successfully.");
                } else {
                    console.error("Failed to toggle water pump.");
                }
            })
            .catch(error => {
                console.error("Error:", error);
            });
     }

    async function sendStateToFlask(state) {
            try {
                const response = await fetch("/send_to_fastapi", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ data: state }),
                });

                const data = await response.json();
                console.log("Response from Flask:", data);
            } catch (error) {
                console.error("Error sending data to Flask:", error);
            }
        }
</script>


</body>
</html>